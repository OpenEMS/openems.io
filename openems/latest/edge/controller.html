<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controller :: Open Energy Management System</title>
    <link rel="canonical" href="https://openems.github.io/openems.io/openems/latest/edge/controller.html">
    <meta name="keywords" content="AsciiDoc">
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="icon" href="../../../_/img/feneco.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../_/css/vendor/docsearch.min.css">  </head>
  <body class="article">
<header class="header">
  <nav class="navbar" color="#2d8fab">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://github.com/OpenEMS/openems">OpenEMS // Docs</a>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/OpenEMS/openems">
          <span class="gitlink">
          </span>
        </a>
      </div>
    </div>
  </nav>
</header><div class="main-wrapper">
<div class="navigation-container" data-component="openems" data-version="latest">
  <aside class="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../introduction.html">Open Energy Management System</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../gettingstarted.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../coreconcepts.html">Core concepts &amp; terminology</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">OpenEMS Edge</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuration.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="nature.html">Nature</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="scheduler.html">Scheduler</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="controller.html">Controller</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="bridge.html">Bridge</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="device_service.html">Device &amp; Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="timedata.html">Timedata</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="implement.html">Implementing a Device</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="build.html">Build OpenEMS Edge</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="deploy.html">Deploy OpenEMS Edge</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">OpenEMS UI</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ui/setup-ide.html">Setup IDE</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ui/architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ui/build.html">Build OpenEMS UI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ui/implementing-a-widget.html">Implementing a UI Widget</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">OpenEMS Backend</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../backend/architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../backend/backend-to-backend.html">Backend-to-Backend</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../backend/build.html">Build OpenEMS Backend</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../backend/deploy.html">Deploy OpenEMS Backend</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../component-communication/index.html">Component Communication</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Simulation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../simulation/gitpod.html">Live-Demo on Gitpod</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../simulation/realtime.html">Real-Time Simulation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../simulation/ui-history.html">UI History Simulation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Contribute</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contribute/coding-guidelines.html">Coding Guidelines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contribute/documentation.html">Documentation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://openems.github.io/openems.io/javadoc/">Javadoc</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Open Energy Management System</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Open Energy Management System</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../introduction.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../introduction.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="../introduction.html">Open Energy Management System</a></li>
    <li class="crumb">OpenEMS Edge</li>
    <li class="crumb"><a href="controller.html">Controller</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/OpenEMS/openems/tree/develop/doc/modules/ROOT/pages/edge/controller.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1>Controller</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_api_backend">1. Api Backend</a></li>
<li><a href="#_api_modbus">2. Api Modbus</a></li>
<li><a href="#_api_mqtt">3. Api MQTT</a></li>
<li><a href="#_rest_api_controller">4. REST-Api Controller</a>
<ul class="sectlevel2">
<li><a href="#_endpoint_restchannelcomponent_idchannel_id">4.1. Endpoint <code>/rest/channel/&lt;Component-ID&gt;/&lt;Channel-ID&gt;</code></a>
<ul class="sectlevel3">
<li><a href="#_get">4.1.1. GET</a></li>
<li><a href="#_post">4.1.2. POST</a></li>
</ul>
</li>
<li><a href="#_endpoint_jsonrpc">4.2. Endpoint '/jsonrpc'</a>
<ul class="sectlevel3">
<li><a href="#_getedgeconfig">4.2.1. getEdgeConfig</a></li>
<li><a href="#_componentjsonapi">4.2.2. componentJsonApi</a>
<ul class="sectlevel4">
<li><a href="#_getmodbusprotocol">4.2.2.1. getModbusProtocol</a></li>
</ul>
</li>
<li><a href="#_updatecomponentconfig">4.2.3. updateComponentConfig</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_api_websocket">5. Api Websocket</a></li>
<li><a href="#_asymmetric_balancing_cos_phi">6. Asymmetric Balancing Cos-Phi</a></li>
<li><a href="#_asymmetric_fix_reactive_power">7. Asymmetric Fix Reactive Power</a></li>
<li><a href="#_asymmetric_peak_shaving">8. Asymmetric Peak-Shaving</a></li>
<li><a href="#_asymmetric_phase_rectification">9. Asymmetric Phase Rectification</a></li>
<li><a href="#_channel_threshold">10. Channel-Threshold</a></li>
<li><a href="#_chp_control_via_state_of_charge_soc">11. CHP control via State-of-Charge (SoC)</a>
<ul class="sectlevel2">
<li><a href="#_configuration">11.1. Configuration</a></li>
<li><a href="#_example_configuration">11.2. Example Configuration</a></li>
</ul>
</li>
<li><a href="#_detailed_debug_log">12. Detailed Debug Log</a></li>
<li><a href="#_debug_log">13. Debug Log</a></li>
<li><a href="#_ess_ac_island">14. ESS AC-Island</a></li>
<li><a href="#_ess_active_power_voltage_characteristic">15. Ess Active Power Voltage Characteristic</a></li>
<li><a href="#_ess_balancing">16. ESS Balancing</a>
<ul class="sectlevel2">
<li><a href="#_requirements">16.1. Requirements</a></li>
<li><a href="#_additional_application_notes">16.2. Additional application notes</a></li>
</ul>
</li>
<li><a href="#_cycle_controller">17. Cycle Controller</a>
<ul class="sectlevel2">
<li><a href="#_configuration_2">17.1. Configuration</a></li>
<li><a href="#_monitoring">17.2. Monitoring</a></li>
<li><a href="#_algorithm_logic">17.3. Algorithm logic</a></li>
</ul>
</li>
<li><a href="#_ess_delay_charge">18. ESS Delay Charge</a></li>
<li><a href="#_ess_delayed_sell_to_grid">19. ESS Delayed Sell-To-Grid</a></li>
<li><a href="#_ess_emergency_capacity_reserve">20. ESS Emergency Capacity Reserve</a></li>
<li><a href="#_symmetric_fix_active_power">21. Symmetric Fix Active Power</a></li>
<li><a href="#_ess_fix_state_of_charge">22. ESS Fix State Of Charge</a></li>
<li><a href="#_ess_grid_optimized_charge">23. ESS Grid Optimized Charge</a></li>
<li><a href="#_hybrid_ess_surplus_feed_to_grid_controller">24. Hybrid-Ess Surplus-Feed-To-Grid Controller</a></li>
<li><a href="#_ess_limit_total_discharge">25. ESS Limit Total Discharge</a></li>
<li><a href="#_ess_linear_power_band">26. ESS Linear Power Band</a></li>
<li><a href="#_ess_minimum_discharge_period">27. ESS Minimum Discharge Period</a></li>
<li><a href="#_ess_reactive_power_voltage_characteristic">28. Ess Reactive Power Voltage Characteristic</a></li>
<li><a href="#_ess_sell_to_grid_limit">29. ESS Sell-To-Grid Limit</a></li>
<li><a href="#_ess_standby">30. ESS Standby</a></li>
<li><a href="#_ess_time_of_use_tariff_discharge">31. ESS Time-of-Use Tariff Discharge</a></li>
<li><a href="#_evcs">32. EVCS</a></li>
<li><a href="#_evcs_fix_active_power">33. EVCS Fix Active Power</a></li>
<li><a href="#_generic_jsonlogic">34. Generic JsonLogic</a></li>
<li><a href="#_high_load_timeslot">35. High-Load Timeslot</a></li>
<li><a href="#_io_alarm">36. IO Alarm</a>
<ul class="sectlevel2">
<li><a href="#_configuration_3">36.1. Configuration</a></li>
<li><a href="#_example_configuration_2">36.2. Example Configuration</a></li>
</ul>
</li>
<li><a href="#_io_channel_single_threshold">37. IO Channel-Single-Threshold</a></li>
<li><a href="#_io_fix_digital_output">38. IO Fix Digital Output</a></li>
<li><a href="#_io_heating_element">39. IO Heating Element</a>
<ul class="sectlevel2">
<li><a href="#_phase_and_level">39.1. Phase and Level</a></li>
<li><a href="#_channels">39.2. Channels</a></li>
</ul>
</li>
<li><a href="#_io_sg_ready_heat_pump">40. IO SG-Ready Heat Pump</a>
<ul class="sectlevel2">
<li><a href="#_states">40.1. States</a></li>
<li><a href="#_channels_2">40.2. Channels</a></li>
</ul>
</li>
<li><a href="#_pv_inverter_fix_power_limit">41. PV-Inverter Fix Power Limit</a></li>
<li><a href="#_pv_inverter_sell_to_grid_limit">42. PV-Inverter Sell-To-Grid limit</a></li>
<li><a href="#_symmetric_balancing_schedule">43. Symmetric Balancing Schedule</a>
<ul class="sectlevel2">
<li><a href="#_1_definition_of_a_power_target_set_point_schedule">43.1. 1. Definition of a power target set-point Schedule</a></li>
<li><a href="#_2_immediate_control_of_the_power_target_set_point">43.2. 2. Immediate control of the power target set-point</a></li>
</ul>
</li>
<li><a href="#_symmetric_fix_reactive_power">44. Symmetric Fix Reactive Power</a></li>
<li><a href="#_symmetric_limit_active_power">45. Symmetric Limit Active Power</a></li>
<li><a href="#_symmetric_peak_shaving">46. Symmetric Peak-Shaving</a></li>
<li><a href="#_symmetric_random_power">47. Symmetric Random-Power</a></li>
<li><a href="#_symmetric_timeslot_peak_shaving">48. Symmetric Timeslot Peak-Shaving</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>A OpenEMS Edge Controller holds the actual business logic or the actual algorithm that controls hardware. The logic of each active Controller is executed regularly on every Cycle, i.e. once per second.</p>
</div>
<div class="paragraph">
<p>On each execution cycle, e.g. once every second, the EMS can send a control command, which allows two different ways of controlling the hardware:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Control by setpoint</strong></p>
<div class="paragraph">
<p>In “control by setpoint” mode, the EMS calculates setpoint commands and sends them to the hardware for immediate execution.</p>
</div>
<div class="paragraph">
<p><em>Example:</em> A power smoothing algorithm uses the current and previous output power values of a photovoltaics system. By applying its configured maximum defined ramp rate it deduces that the energy storage systems needs to be discharged with 150 kW to compensate a suddenly reduced output power. It therefore sends a setpoint for "discharge with 150 kW" to the ESS for immediate execution.</p>
</div>
</li>
<li>
<p><strong>Control by parameterization</strong></p>
<div class="paragraph">
<p>In “control by parameterization” mode, the EMS sends the configuration parameters for control algorithms embedded into the hardware for internal execution.</p>
</div>
<div class="paragraph">
<p><em>Example:</em> In a Virtual Inertia Ancillary Services application,     the EMS sends the configuration parameters for the control characteristics to the ESS. The ESS uses this parameter set for its internal, high-performance algorithm.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following Controllers are implemented in the OpenEMS standard codebase. The links point directly to the source code.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_api_backend"><a class="anchor" href="#_api_backend"></a>1. Api Backend</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Connects to OpenEMS Backend and sends all Channel data regularly. It is implemented as a Controller, as Channels can be written from OpenEMS Backend.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.api.backend">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_api_modbus"><a class="anchor" href="#_api_modbus"></a>2. Api Modbus</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The OpenEMS Edge Modbus-Slave-API is provided by the "Modbus-API Controller".
As the Modbus protocol is widely used in industrial monitoring and automation, this allows for easy access to OpenEMS channels from external systems.</p>
</div>
<div class="paragraph">
<p>The configuration of the Modbus-API controller defines which OpenEMS Components should be exported and made available via the API.
It then generates a dynamic Modbus protocol that is structured in address blocks that map to OpenEMS Components and Modbus register addresses that map to OpenEMS channels.</p>
</div>
<div class="paragraph">
<p>The modbus table is designed in a way that allows dynamic parsing of all available registers.</p>
</div>
<div class="paragraph">
<p>The following example describes a Controller that is configured to export the Sum-Component (<code>_sum</code>). By reading the headers of the individual blocks, the entire Modbus protocol can be parsed dynamically:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Register <code>0</code> identifies the system as an OpenEMS by the hash value <code>0x17ed6201</code>.</p>
</li>
<li>
<p>Register <code>1</code> shows the length of the first block. Adding the length (<code>199</code>) the current address (<code>1</code>) gives the starting address of the next block (<code>200</code>).</p>
</li>
<li>
<p>Register <code>200</code> gives a string with fixed length of 16 characters with the Component-ID.</p>
</li>
<li>
<p>Register <code>216</code> shows the length of the complete block. Adding the length (<code>300</code>) to the starting address of the block (<code>200</code>) gives the starting address of the next block (<code>500</code>) and so forth.</p>
</li>
<li>
<p>Register <code>220</code> identifies the first sub-block as Nature <code>OpenemsComponent</code>. The length of the sub-block follows in Register <code>221</code> and gives the starting address of the next sub-block (<code>300</code>) and so on.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Instead of parsing the Modbus protocol, it is also possible to download the EMS specific Excel file via OpenEMS UI "System Profile" menu. An example export is available in the 'doc' folder of this bundle.</p>
</div>
<div class="paragraph">
<p>To communicate with specific channels, it is then sufficient to read or write to the matching registers, e.g.
- Read register <code>302 _sum/EssSoc</code> to get the total average state of charge of the ESS.
- Write to register <code>806 ess0/SetActivePowerEquals</code> to trigger charging or discharging of the ESS with ID <code>ess0</code>.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.api.modbus">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_api_mqtt"><a class="anchor" href="#_api_mqtt"></a>3. Api MQTT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Publishes OpenEMS Edge data to a MQTT broker.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>edge/{OpenEMS-Edge-ID}/channel/{Component-ID}/{Channel-ID}</code></p>
<div class="ulist">
<ul>
<li>
<p>Data of Channels is published on change and at least every 5 minutes to these topics.</p>
</li>
<li>
<p>Example: <code>edge/edge0/channel/_sum/GridActivePower</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>edge/{OpenEMS-Edge-ID}/channel/lastUpdate</code></p>
<div class="ulist">
<ul>
<li>
<p>Timestamp of the latest data update on any of the Channel topics above.</p>
</li>
<li>
<p>Example: <code>edge/edge0/channel/lastUpdate</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>edge/{OpenEMS-Edge-ID}/edgeConfig</code></p>
<div class="ulist">
<ul>
<li>
<p>Configuration of the OpenEMS Edge instance is published to this topic as a JsonObject.</p>
</li>
<li>
<p>Example: <code>edge/edge0/edgeConfig</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.api.mqtt">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rest_api_controller"><a class="anchor" href="#_rest_api_controller"></a>4. REST-Api Controller</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A REST-Api for external access to OpenEMS Edge. This Controller provides access to Channels and JSON-RPC Requests from an external device via JSON/REST.</p>
</div>
<div class="paragraph">
<p>The default port for the server is <strong>8084</strong>; so the default base address for REST calls is <code><a href="http://x:&lt;PASSWORD&gt;@&lt;IP&gt;:8084/rest" class="bare">http://x:&lt;PASSWORD&gt;@&lt;IP&gt;:8084/rest</a></code>, where</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>http</code> is the protocol</p>
</li>
<li>
<p><code>x</code> is the user. Authentication in OpenEMS is via password only, so the username can be omitted.</p>
</li>
<li>
<p><code>&lt;PASSWORD&gt;</code> is the user password. If no specific settings have been made, try 'user' or 'admin' here.</p>
</li>
<li>
<p><code>8084</code> is the configured port</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A good way to test REST-Api calls is via the Chrome extension <a href="https://chrome.google.com/webstore/detail/restlet-client-rest-api-t/aejoelaoggembcahagimdiliamlcdmfm">Restlet</a></p>
</div>
<div class="paragraph">
<p>For more information find the implementation  <a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.api.rest">Source Code <span class="icon"><i class="fa fa-github"></i></span></a>.</p>
</div>
<div class="paragraph">
<p>Those are the available REST-Api endpoints:</p>
</div>
<div class="sect2">
<h3 id="_endpoint_restchannelcomponent_idchannel_id"><a class="anchor" href="#_endpoint_restchannelcomponent_idchannel_id"></a>4.1. Endpoint <code>/rest/channel/&lt;Component-ID&gt;/&lt;Channel-ID&gt;</code></h3>
<div class="ulist">
<ul>
<li>
<p><code>Component-ID</code> is the ID of the Component, e.g. "_sum", "ess0", "meter0",&#8230;&#8203;</p>
</li>
<li>
<p><code>Channel-ID</code> is the ID of the Channel, e.g. "ActivePowerL1", "Soc",&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_get"><a class="anchor" href="#_get"></a>4.1.1. GET</h4>
<div class="paragraph">
<p>Use a HTTP request with method <code>GET</code> to read the current value of a Channel.</p>
</div>
<div class="paragraph">
<p><strong>Example:</strong> To read the current state of charge of the battery, send a GET request to <a href="http://x:user@localhost:8084/rest/channel/_sum/EssSoC" class="bare">http://x:user@localhost:8084/rest/channel/_sum/EssSoC</a>. It returns a response like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
  "type":"INTEGER",
  "accessMode":"RO",
  "text":"",
  "unit":"%",
  "value":50
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>GET</code> api also understands regular expressions. Send a GET request to <a href="http://x:user@localhost:8084/rest/channel/.*/Active.*Power" class="bare">http://x:user@localhost:8084/rest/channel/.*/Active.*Power</a> to read all <code>ActivePower</code> and <code>ReactivePower</code> channels of all components. It returns a response like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[
  {
    "address":"pvInverter0/ActivePower",
    "type":"INTEGER",
    "accessMode":"RO",
    "text":"",
    "unit":"W",
    "value":90
  },
  {
    "address":"meter0/ActiveProductionPower",
    "type":"INTEGER",
    "accessMode":"RO",
    "text":"",
    "unit":"W",
    "value":465
  },
  {
    "address":"meter0/ActivePower",
    "type":"INTEGER",
    "accessMode":"RO",
    "text":"",
    "unit":"W",
    "value":465
  },
  {
    "address":"meter0/ActiveConsumptionPower",
    "type":"INTEGER",
    "accessMode":"RO",
    "text":"",
    "unit":"W",
    "value":0
  }
]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_post"><a class="anchor" href="#_post"></a>4.1.2. POST</h4>
<div class="paragraph">
<p>Use a HTTP request with method <code>POST</code> to write a Channel.</p>
</div>
<div class="paragraph">
<p><strong>Example:</strong> To switch a Digital-Output or Relay on, send a POST request to <a href="http://x:user@localhost:8084/rest/channel/io0/Relay1" class="bare">http://x:user@localhost:8084/rest/channel/io0/Relay1</a> with the following body:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
  "value": true
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_endpoint_jsonrpc"><a class="anchor" href="#_endpoint_jsonrpc"></a>4.2. Endpoint '/jsonrpc'</h3>
<div class="paragraph">
<p>This allows remote procedure calls (RPC) using JSON-RPC. The JSON-RPC commands need to be sent as <code>POST</code> requests with the specified body.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
JSON-RPC usually requires the properties 'id' and 'jsonrpc'. Those can be omitted here, as they are not required for HTTP POST calls.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Following JSON-RPC commands are available:</p>
</div>
<div class="sect3">
<h4 id="_getedgeconfig"><a class="anchor" href="#_getedgeconfig"></a>4.2.1. getEdgeConfig</h4>
<div class="paragraph">
<p>Gets the current configuration of the OpenEMS Edge.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
  "method": "getEdgeConfig",
  "params": {}
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_componentjsonapi"><a class="anchor" href="#_componentjsonapi"></a>4.2.2. componentJsonApi</h4>
<div class="paragraph">
<p>Forwards a JSON-RPC payload to a given Component, identified by its Component-ID.</p>
</div>
<div class="sect4">
<h5 id="_getmodbusprotocol"><a class="anchor" href="#_getmodbusprotocol"></a>4.2.2.1. getModbusProtocol</h5>
<div class="paragraph">
<p>Gets the currently active Modbus-TCP protocol definition from the Modbus-TCP-Api Controller with the ID "ctrlModbusTcp0".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
  "method":"componentJsonApi",
  "params":{
    "componentId":"ctrlApiModbusTcp0",
    "payload":{
      "method":"getModbusProtocol",
      "params":{

      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_updatecomponentconfig"><a class="anchor" href="#_updatecomponentconfig"></a>4.2.3. updateComponentConfig</h4>
<div class="paragraph">
<p>Updates a Component configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
	"method": "updateComponentConfig",
	"params": {
		"componentId": "ctrlDebugLog0",
		"properties": [{
 			"name": "enabled",
			"value": true
		}]
	}
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_api_websocket"><a class="anchor" href="#_api_websocket"></a>5. Api Websocket</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Provides a JSON/REST implementation via HTTP Websocket for OpenEMS Edge. It provides access to Channels and JSON-RPC Requests from an external device via Websocket. This Controller is used for local connection of OpenEMS UI.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.api.websocket">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_asymmetric_balancing_cos_phi"><a class="anchor" href="#_asymmetric_balancing_cos_phi"></a>6. Asymmetric Balancing Cos-Phi</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Controls an asymmetric energy storage system in self-consumption optimization mode while keeping the grid meter on a defined cos-phi.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.asymmetric.balancingcosphi">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_asymmetric_fix_reactive_power"><a class="anchor" href="#_asymmetric_fix_reactive_power"></a>7. Asymmetric Fix Reactive Power</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sets a fixed reactive power for an asymmetric energy storage system.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.asymmetric.fixreactivepower">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_asymmetric_peak_shaving"><a class="anchor" href="#_asymmetric_peak_shaving"></a>8. Asymmetric Peak-Shaving</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Applies asymmetric peak-shaving at the grid meter using a energy storage system. The controller evaluates the grid meter phase with the highest load and discharges the energy storage system accordingly to cut this power peak in order to avoid the fuse to be triggered. On low consumption periods the energy storage system recharges.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.asymmetric.peakshaving">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_asymmetric_phase_rectification"><a class="anchor" href="#_asymmetric_phase_rectification"></a>9. Asymmetric Phase Rectification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Balances the three phases at the grid using an asymmetric energy storage system.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.asymmetric.phaserectification">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_channel_threshold"><a class="anchor" href="#_channel_threshold"></a>10. Channel-Threshold</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Generic Controller that sets a digital output according to the value of given Channel - e.g. turn a Relay on, when battery state of charge is above a given threshold.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.channelthreshold">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chp_control_via_state_of_charge_soc"><a class="anchor" href="#_chp_control_via_state_of_charge_soc"></a>11. CHP control via State-of-Charge (SoC)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Controls a CHP device. Signals the CHP to turn 'ON' when battery SoC is low; signal it to turn 'OFF' when SoC is high. This controller needs four parameters,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>State of Charge(Soc) of the ESS.</p>
</li>
<li>
<p>Low Threshold(LT) Soc</p>
</li>
<li>
<p>High Threshold(HT) Soc</p>
</li>
<li>
<p>Output channel to signal.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Soc of the Ess is compared with the LT and HT, and The following operations or state change is performed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the Soc is less-than("&lt;") LT, signal is sent to the Output channel which eventually turns the CHP device 'ON'.</p>
</li>
<li>
<p>If the Soc is greater-than("&gt;") HT, signal is sent to the Output channel which turns the CHP device 'OFF'.</p>
</li>
<li>
<p>Any other conditions the there is no change in the State of the CHP device.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_configuration"><a class="anchor" href="#_configuration"></a>11.1. Configuration</h3>
<div class="ulist">
<ul>
<li>
<p><code>Component-ID</code> Unique ID of this Component (id), e.g. "ctrlIoAlarm0", "ctrlIoAlarm1"</p>
</li>
<li>
<p><code>Alias</code> Human-readable name of this Component; defaults to Component-ID (alias)</p>
</li>
<li>
<p><code>Input Channels</code> Addresses of the input State-Channels (inputChannelAddress), This is a array of input state channels.</p>
</li>
<li>
<p><code>Output Channel</code> Channel address of the Digital Output that should be switched (outputChannelAddress)</p>
</li>
<li>
<p><code>Low Threshold</code> Low boundary of the threshold</p>
</li>
<li>
<p><code>High Threshold</code> High boundary of the threshold</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_example_configuration"><a class="anchor" href="#_example_configuration"></a>11.2. Example Configuration</h3>
<div class="ulist">
<ul>
<li>
<p><code>Component-ID</code> : ctrlChpSoc0</p>
</li>
<li>
<p><code>Alias</code> : myChpCtrl</p>
</li>
<li>
<p><code>Input Channels</code> : _sum/EssSoc</p>
</li>
<li>
<p><code>Output Channel</code> : io0/Relay1</p>
</li>
<li>
<p><code>Low Threshold</code> 25</p>
</li>
<li>
<p><code>High Threshold</code> 75</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
_sum/EssSoc - represents the Soc channel of the ESS0,
io0/relay1 - represents the relay 1 of the relay board.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.chp.soc">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_detailed_debug_log"><a class="anchor" href="#_detailed_debug_log"></a>12. Detailed Debug Log</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Constantly shows the values of all Channels of a Component on the console. Primarily used for developing and debugging.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.debug.detailedlog">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_debug_log"><a class="anchor" href="#_debug_log"></a>13. Debug Log</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Constantly shows the most important values of all Components on the console. This is often activated by default to be able to track the running system easily.</p>
</div>
<div class="paragraph">
<p>The 'most important values' are predefined by the individual OpenEMS Components. The configuration allows to</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>additionalChannels</code></dt>
<dd>
<p>add additional Channels to the log</p>
</dd>
<dt class="hdlist1"><code>ignoreComponents</code></dt>
<dd>
<p>ignore the output of certain Components</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The priority of <code>additionalChannels</code> is higher than <code>ignoreComponents</code>, so an explicitly added Channel will be logged even if the Component has explicitly been ignored.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.debug.log">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ess_ac_island"><a class="anchor" href="#_ess_ac_island"></a>14. ESS AC-Island</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Switches an AC PV inverter to the emergency power on grid outage.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.ess.acisland">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ess_active_power_voltage_characteristic"><a class="anchor" href="#_ess_active_power_voltage_characteristic"></a>15. Ess Active Power Voltage Characteristic</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>This controller charges/discharges an energy storage system with active power in order to keep the grid voltage within an acceptable range.</p>
</li>
<li>
<p>The active power set-point depends on the ratio of the grid voltage divided by the configured <code>nominalVoltage</code> parameter.</p>
</li>
<li>
<p>The active power per voltage ratio is defined by a poly-line graph in the <code>lineConfig</code> parameter. It takes a Json-Array of the following form:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>[
   {
      "voltageRatio":0.95,
      "power":4000
   },
   {
      "voltageRatio":0.97999,
      "power":1000
   },
   {
      "voltageRatio":0.98,
      "power":0
   },
   {
      "voltageRatio":1.0299,
      "power":0
   },
   {
      "voltageRatio":1.03,
      "power":-1000
   },
   {
      "voltageRatio":1.05,
      "power":-4000
   }
]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>waitForHysteresis</code> parameter: active power set-point is not updated more often than the hysteresis time in seconds. Default value is 20 seconds. The purpose of this parameter is to avoid oscillation in grid voltage via frequently setting power.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/feature/develop/io.openems.edge.controller.ess.activepowervoltagecharacteristic">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ess_balancing"><a class="anchor" href="#_ess_balancing"></a>16. ESS Balancing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This controls a energy storage system in self-consumption optimization mode by trying to balance the power at the grid connection point, i.e.:
- charge the battery, when production is larger than consumption (i.e. when feeding power to the grid)
- discharge the battery, when consumption is larger than production (i.e. when buying power from the grid)</p>
</div>
<div class="sect2">
<h3 id="_requirements"><a class="anchor" href="#_requirements"></a>16.1. Requirements</h3>
<div class="ulist">
<ul>
<li>
<p>ManagedSymmetricEss, a controllable energy storage system</p>
</li>
<li>
<p>ElectricityMeter, a meter at the grid connection point</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_additional_application_notes"><a class="anchor" href="#_additional_application_notes"></a>16.2. Additional application notes</h3>
<div class="paragraph">
<p>Above description assumes that the grid connection point should be balanced to <code>0 Watt</code>. This bevahiour is configurable using the <code>targetGridSetpoint</code> configuration parameter.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.ess.balancing">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cycle_controller"><a class="anchor" href="#_cycle_controller"></a>17. Cycle Controller</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Developed in order to provide cycle, capacity test scenarios.</p>
</div>
<div class="sect2">
<h3 id="_configuration_2"><a class="anchor" href="#_configuration_2"></a>17.1. Configuration</h3>
<div class="paragraph">
<p>Parameters which should be taken care of:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ess_id</code></dt>
<dd>
<p>Id of the device. ex, ess0</p>
</dd>
<dt class="hdlist1"><code>cycleOrder</code></dt>
<dd>
<p>Initial step decide whether to start with charge or discharge in type of 'CycleOrder'. ex, CycleOrder.START_WITH_DISCHARGE</p>
</dd>
<dt class="hdlist1"><code>standbyTime</code></dt>
<dd>
<p>The time is to wait between charge and discharge, asked to be given in minute. ex, standby=5, means wait 5 minute before to switch from charge to discharge.</p>
</dd>
<dt class="hdlist1"><code>startTime</code></dt>
<dd>
<p>Start Time in Hour should be configured like [YYYY-MM-DD HH:MM]. Also provide an opportunity to activate the controller for required date and time.</p>
</dd>
<dt class="hdlist1"><code>maxSoc</code></dt>
<dd>
<p>The maximum Soc value that will be reached for charging when the controller is activated. If its set to 100, limit condition will be considered for allowed charge power. For value 100, when allowed charge power is 0, charge will be stopped.</p>
</dd>
<dt class="hdlist1"><code>minSoc</code></dt>
<dd>
<p>The minimum Soc value that will be reached for charging when the controller is activated. If its set to 0, limit condition will be considered for allowed discharge power. For value 0, when allowed discharge power is 0, charge will be stopped.</p>
</dd>
<dt class="hdlist1"><code>power</code></dt>
<dd>
<p>The power in Watt to charge or discharge.</p>
</dd>
<dt class="hdlist1"><code>totalCycleNumber</code></dt>
<dd>
<p>Decides for how many times cycles to apply.</p>
</dd>
<dt class="hdlist1"><code>finalSoc</code></dt>
<dd>
<p>The Soc value which will be kept in the battery after cycle test completed.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_monitoring"><a class="anchor" href="#_monitoring"></a>17.2. Monitoring</h3>
<div class="paragraph">
<p>Channels can be followed from Grafana or online monitoring:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ctrlEssCycle0/AwaitingHysteresis</code></dt>
<dd>
<p>Active when waiting between two states (see standby-time)</p>
</dd>
<dt class="hdlist1"><code>ctrlEssCycle0/CompletedCycleNumber</code></dt>
<dd>
<p>Number of already completed cycles</p>
</dd>
<dt class="hdlist1"><code>ctrlEssCycle0/StateMachine</code></dt>
<dd>
<p>The current State of the State-Machine: UNDEFINED, FINISHED, CHARGE, DISCHARGE, STORE_SOC, etc. states.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_algorithm_logic"><a class="anchor" href="#_algorithm_logic"></a>17.3. Algorithm logic</h3>
<div class="paragraph">
<p>Controller starts with <code>UNDEFINED</code> state. First checks for <code>cycleOrder</code> configuration. If it is defined, according to the selection goes to <code>CHARGE or `DISCHARGE</code> state.
If <code>cycleOrder</code> is not defined, selection is made according to the Soc value.
If Soc is higher than 50 % starts with <code>CHARGE</code> state, otherwise starts with <code>DISCHARGE</code> state.</p>
</div>
<div class="paragraph">
<p>If the second state is <code>CHARGE</code> state, controller start to charge the system until <code>maxSoc</code>. Again, if it is configured as 100 %, when allowed charge power is 0 W, charge will be stopped. Then, based on the <code>standbyTime</code> configuration will wait until hysteresis completed.
Afterwards, will switch to <code>DISCHARGE</code> state.</p>
</div>
<div class="paragraph">
<p>If the second state is <code>DISCHARGE</code> state, controller start to discharge the system until <code>minSoc</code>. Again, if it is configured as 0 %, when allowed discharge power is 0 W, discharge will be stopped. Then, based on the <code>standbyTime</code> configuration will wait until hysteresis completed.
Afterwards, will switch to <code>CHARGE</code> state.</p>
</div>
<div class="paragraph">
<p>After first <code>CHARGE</code> and <code>DISCHARGE</code> next state will be <code>FINISHED</code>. If the <code>totalCycleNumber</code> is "1", next state will be <code>FINAL_SOC</code>. And in this state, according to the <code>finalSoc</code> system will be charged or discharged last time.
If the <code>totalCycleNumber</code> is higher than "1", next cycle will be called. This process will repeat itself until <code>totalCycleNumber</code> reaches. At the end, last state will be <code>FINAL_SOC</code> and required last Soc value will be kept in the battery.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.ess.cycle">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ess_delay_charge"><a class="anchor" href="#_ess_delay_charge"></a>18. ESS Delay Charge</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This Controller delays full charing of an energy storage system (ESS) to a certain hour of the day. If for example configured to delay till 4 pm, the allowed charge power is limited in a way, that 100 % State-of-Charge is reached only at 4 pm. The Controller therefor constantly watches the remaining time and remaining capacity of the ESS.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.ess.delaycharge">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ess_delayed_sell_to_grid"><a class="anchor" href="#_ess_delayed_sell_to_grid"></a>19. ESS Delayed Sell-To-Grid</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Controls an energy storage system so, that it delays the sell-to-grid power e.g. of a photovoltaics system.</p>
</div>
<div class="paragraph">
<p>It charges the battery, when sell-to-grid power exceeds the configured "Sell-To-Grid power limit"
and discharges when sell-to-grid power is falling below "Continuous Sell-To-Grid power".</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.ess.delayedselltogrid">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ess_emergency_capacity_reserve"><a class="anchor" href="#_ess_emergency_capacity_reserve"></a>20. ESS Emergency Capacity Reserve</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This Controller allows setting a <code>ReserveSoc</code> as the minimum State-Of-Charge that should be reached during normal on-grid operation, i.e. a energy storage system in self-consumption optimization mode will stop discharging at this SoC.</p>
</div>
<div class="paragraph">
<p>It is used to keep a certain part of the capacity as reserve for power outage situations.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.ess.emergencycapacityreserve">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_symmetric_fix_active_power"><a class="anchor" href="#_symmetric_fix_active_power"></a>21. Symmetric Fix Active Power</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sets a fixed active power for charging/discharging of a symmetric energy storage system.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.symmetric.fixactivepower">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ess_fix_state_of_charge"><a class="anchor" href="#_ess_fix_state_of_charge"></a>22. ESS Fix State Of Charge</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sets active power constraints for charging/discharging of a symmetric energy storage system, to reach a final SoC under the constraints below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>State of Charge should be reached at a certain time or as fast as possible</p>
</li>
<li>
<p>State of Charge is held for a configured time or optionally until a specific end condition is fulfilled</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.ess.fixstateofcharge">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ess_grid_optimized_charge"><a class="anchor" href="#_ess_grid_optimized_charge"></a>23. ESS Grid Optimized Charge</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Combination of the PredictiveDelayCharge and the SellToGridPowerLimit controllers:</p>
</div>
<div class="paragraph">
<p>Delays the charging of the AC or DC storage system based on predicted production and consumption given by the PredictorManager.</p>
</div>
<div class="paragraph">
<p>Even during the delayed charging, the battery is able to force charge when the sell-to-grid power exceeds the configured "Sell-To-Grid maximum power limit".
This is mainly used when only 70 percent of the maximum production is allowed to feed in to the grid.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.ess.gridoptimizedcharge">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hybrid_ess_surplus_feed_to_grid_controller"><a class="anchor" href="#_hybrid_ess_surplus_feed_to_grid_controller"></a>24. Hybrid-Ess Surplus-Feed-To-Grid Controller</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Controls a Hybrid Battery Inverter (i.e. integrated Energy Storage System) so, that the surplus DC production of its chargers gets fed to grid.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.ess.hybrid.surplusfeedtogrid">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ess_limit_total_discharge"><a class="anchor" href="#_ess_limit_total_discharge"></a>25. ESS Limit Total Discharge</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Limits the discharge power of an energy storage system according to its State-of-Charge, e.g. to keep energy for emergency power or to avoid deep discharge.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.ess.limittotaldischarge">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ess_linear_power_band"><a class="anchor" href="#_ess_linear_power_band"></a>26. ESS Linear Power Band</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Executes a test cycle for an energy storage system by increasing and decreasing the charging/discharging power in given limits.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.ess.linearpowerband">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ess_minimum_discharge_period"><a class="anchor" href="#_ess_minimum_discharge_period"></a>27. ESS Minimum Discharge Period</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Provides a minimum discharge power of the storage system for a configured time period, if a certain power peak has been reached.</p>
</div>
<div class="paragraph">
<p>This can be used in some systems where the allowed charge power has been set to zero and the storage needs a minimum discharge power for a certain time, to recognize that the storage is not full and the allowed charge power should be higher.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.ess.mindischargeperiod">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ess_reactive_power_voltage_characteristic"><a class="anchor" href="#_ess_reactive_power_voltage_characteristic"></a>28. Ess Reactive Power Voltage Characteristic</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>This controller sets reactive power of an energy storage system in order to keep the grid voltage within an acceptable range.</p>
</li>
<li>
<p>The reactive power set-point depends on the ratio of the grid voltage divided by the configured <code>nominalVoltage</code> parameter.</p>
</li>
<li>
<p>The reactive power set-point is defined as percent of the maximum apparent power of the inverter.</p>
</li>
<li>
<p>The reactive power per voltage ratio is defined by a poly-line graph in the <code>lineConfig</code> parameter. It takes a Json-Array of the following form:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>[
   {
      "voltageRatio":0.9,
      "percent":60
   },
   {
      "voltageRatio":0.93,
      "percent":0
   },
   {
      "voltageRatio":1.07
      "percent":0
   },
   {
      "voltageRatio":1.1,
      "percent":-60
   }
]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>waitForHysteresis</code> parameter: reactive power set-point is not updated more often than the hysteresis time in seconds. Default value is 20 seconds. The purpose of this parameter is to avoid oscillation in grid voltage via frequently setting power.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/feature/develop/io.openems.edge.controller.ess.reactivepowervoltagecharacteristic">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ess_sell_to_grid_limit"><a class="anchor" href="#_ess_sell_to_grid_limit"></a>29. ESS Sell-To-Grid Limit</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Limits the maximum sell-to-grid power by actively charging the Ess.
Can be used to apply a 70 % limit to the sell-to-grid power according to German law.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.ess.selltogridlimit">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ess_standby"><a class="anchor" href="#_ess_standby"></a>30. ESS Standby</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Regularly checks the functionality of an ESS once per week while being in Standby mode.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Use-Case</dt>
<dd>
<p>In projects with Hochlastzeitfenster (HLZF) the storage system might not be used for some weeks or months. In these periods it is required to make a regular check of the system and to calibrate the battery. This controller automates this function.</p>
</dd>
<dt class="hdlist1">Scheduling</dt>
<dd>
<p>The controller is supposed to be configured to run with less priority than "LimitTotalDischarge", "BatteryHandling",&#8230;&#8203; and higher priority than "HLZF", "Balancing", "Peak-Shaving",&#8230;&#8203;</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.ess.standby">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ess_time_of_use_tariff_discharge"><a class="anchor" href="#_ess_time_of_use_tariff_discharge"></a>31. ESS Time-of-Use Tariff Discharge</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This Controller optimizes the behaviour of an energy storage system in combination with a Time-Of-Use (ToU) Tariff.</p>
</div>
<div class="paragraph">
<p>The general estimation is, that during the day a local PV system can provide enough energy to supply the consumption. This Controller than evaluates the predicted consumed energy during the night (using production and consumption predictors) and tries to move Buy-From-Grid periods to cheap hours.</p>
</div>
<div class="paragraph">
<p>This implementation works for AC, DC and Hybrid ESS. It is currently limited to the ToU tariff by aWATTar.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>At 14:00, controller collects the Hourly prices from the aWATTar API and also the predicions of production and consumption from prediction service in OpenEMS.</p>
</li>
<li>
<p>It calculates the boundary hours to differentiate day and night, so that the controller can get defined set of hours to work on.</p>
</li>
<li>
<p>During the start of the boundary hours, based on current State-of-Charge and hourly prices already calculated, it determines the set of cheapest hours.</p>
</li>
<li>
<p>During those set of hours (Cheap Hours), the discharging is blocked. consumption is covered from the grid.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This Controller applies to the legislation of Germany.</p>
</div>
<div class="paragraph">
<p>TODO</p>
</div>
<div class="paragraph">
<p>Time of Use (ToU) pricing API service is currently under implementation in OpenEMS. This service will eventually act as generalised service for all the variable pricing providers.</p>
</div>
<div class="paragraph">
<p>Once the ToU service is implemented, the test cases can be uncommented and tested with custom hourly prices. Currently only way to test it is by using the actual API provided by Awattar.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_evcs"><a class="anchor" href="#_evcs"></a>32. EVCS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Controls an Electric Vehicle Charging Station (EVCS) in different modes, like "Force-Charge" and "Surplus Energy Charging".</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.evcs">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_evcs_fix_active_power"><a class="anchor" href="#_evcs_fix_active_power"></a>33. EVCS Fix Active Power</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sets a fixed maximum charge power to an Electric Vehicle Charging Station (EVCS).</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.evcs.fixactivepower">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generic_jsonlogic"><a class="anchor" href="#_generic_jsonlogic"></a>34. Generic JsonLogic</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The JsonLogic-Controller is a very generic Controller that allows the definition of a complex logic as a configuration at runtime, e.g. via Apache Felix Web Console.</p>
</div>
<div class="paragraph">
<p>It is based on the JsonLogic specification (<a href="http://jsonlogic.com">jsonlogic.com</a>). Logics can be defined by a rule:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "if":[
      {
         "&lt;":[
            {
               "var":"_sum/EssSoc"
            },
            50
         ]
      },
      [
         [
            "ess0/SetActivePowerEquals",
            5000
         ]
      ],
      [
         [
            "ess0/SetActivePowerEquals",
            -2000
         ]
      ]
   ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The input data that is referenced via <code>var</code> is automatically provided from OpenEMS Channels - e.g. as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "_sum/EssSoc": 40
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example would result in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
    "ess0/SetActivePowerEquals",
    5000
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>i.e. the Controller will require a set-point of 5000 W discharge on ess0.</p>
</div>
<div class="paragraph">
<p>It is also possible to write to multiple channels, by adding more arrays to the result.</p>
</div>
<div class="paragraph">
<p>Try yourself: <a href="http://jsonlogic.com/play.html">http://jsonlogic.com/play.html</a></p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.generic.jsonlogic">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_high_load_timeslot"><a class="anchor" href="#_high_load_timeslot"></a>35. High-Load Timeslot</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Controls an energy storage system for a High-Load timeslot application (German "Hochlastzeitfenster").</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.highloadtimeslot">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_io_alarm"><a class="anchor" href="#_io_alarm"></a>36. IO Alarm</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Switches a digital output, when one or more State-Channels are set. This controller can be used to signal alarms.
This controller is used to check for the State-Channels which are boolean type, which typically represents the error channels. A specific configured digital output channel can be signaled based on the configured input State-Channels(one more channels).</p>
</div>
<div class="sect2">
<h3 id="_configuration_3"><a class="anchor" href="#_configuration_3"></a>36.1. Configuration</h3>
<div class="ulist">
<ul>
<li>
<p><code>Component-ID</code> Unique ID of this Component (id), e.g. "ctrlIoAlarm0", "ctrlIoAlarm1"</p>
</li>
<li>
<p><code>Alias</code> Human-readable name of this Component; defaults to Component-ID (alias)</p>
</li>
<li>
<p><code>Input Channels</code> Addresses of the input State-Channels (inputChannelAddress), This is a array of input state channels.</p>
</li>
<li>
<p><code>Output Channel</code> Channel address of the Digital Output that should be switched (outputChannelAddress)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Multiple instances can be created in "Apache felix" during the configuration for each Output channel signal.</p>
</div>
</div>
<div class="sect2">
<h3 id="_example_configuration_2"><a class="anchor" href="#_example_configuration_2"></a>36.2. Example Configuration</h3>
<div class="ulist">
<ul>
<li>
<p><code>Component-ID</code> : ctrlIoAlarm0</p>
</li>
<li>
<p><code>Alias</code> : myIoAlarm</p>
</li>
<li>
<p><code>Input Channels</code> : [ess0/State15, ess0/State33, ess0/State43]</p>
</li>
<li>
<p><code>Output Channel</code> : io0/Relay1</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ess0/State15 - represents the State15 channels of the ESS0,
io0/relay1 = represents the relay 1 of the KM tronic relay board.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example configuration describes, if any of the configured three input channels is set to "True" then a signal "True" is sent to output channel, else the "False" signal is sent to output channel.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.io.alarm">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_io_channel_single_threshold"><a class="anchor" href="#_io_channel_single_threshold"></a>37. IO Channel-Single-Threshold</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Generic Controller that sets a digital output according to the value of given Channel - e.g. turn a Relay on or off, when configured input channel/SoC is above or below a given threshold respectively.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.channelsinglethreshold">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_io_fix_digital_output"><a class="anchor" href="#_io_fix_digital_output"></a>38. IO Fix Digital Output</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sets a digital output statically ON or OFF.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.io.fixdigitaloutput">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_io_heating_element"><a class="anchor" href="#_io_heating_element"></a>39. IO Heating Element</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Controls a three-phase heating element via Relays, according to grid active power.</p>
</div>
<div class="sect2">
<h3 id="_phase_and_level"><a class="anchor" href="#_phase_and_level"></a>39.1. Phase and Level</h3>
<div class="paragraph">
<p>The Controller distinguishes the definition of Phase and Level.
<strong>Phase</strong> represents the electrical phase L1, L2 or L3.
<strong>Level</strong> represents how many Phases are active at one point in time:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Level 1: only Phase L1 is active</p>
</li>
<li>
<p>Level 2: Phase L1 and L2 are active</p>
</li>
<li>
<p>Level 3: all three Phases are active</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_channels"><a class="anchor" href="#_channels"></a>39.2. Channels</h3>
<div class="paragraph">
<p>Example:
* the power of the heating element per phase is 1000 W
* each "x" below represents one hour</p>
</div>
<div class="paragraph">
<p>Assume the Controller was activating Phases L1, L2 and L3 during the day like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>L3|           xxx
L2|        xxxxxxxxx
L1|     xxxxxxxxxxxxxxxx
 t|------------------------</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Channel <em>Phase1Time</em></dt>
<dd>
<p><code>= 16 h = <strong>57600 sec</strong></code></p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>        |--------------|</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Channel <em>Phase2Time</em></dt>
<dd>
<p><code>= 9 hours = <strong>32400 sec</strong></code></p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>           |-------|</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Channel <em>Phase3Time</em></dt>
<dd>
<p><code>= 3 hours = <strong>10800 sec</strong></code></p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>              |-|</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Channel <em>Level1Time</em></dt>
<dd>
<p><code>= Phase1Time - Phase2Time = 7 hours = <strong>25200 sec</strong></code></p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>        |-|         |--|</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Channel <em>Level2Time</em></dt>
<dd>
<p><code>= Phase2Time - Phase3Time = 6 hours = <strong>21600 sec</strong></code></p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>           |-|   |-|</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Channel <em>Level3Time</em></dt>
<dd>
<p><code>= Phase3Time = 3 hours = <strong>10800 sec</strong></code></p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>              |-|</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Channel <em>TotalTime</em></dt>
<dd>
<p><code><strong>28000 Wh</strong> = 28 kWh</code></p>
</dd>
<dt class="hdlist1">Channel <em>TotalPhaseTime</em></dt>
<dd>
<p><code>= Phase1Time + Phase2Time + Phase3Time = 16 + 9 + 3 = 28 h = <strong>100800 sec</strong></code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.io.heatingelement">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_io_sg_ready_heat_pump"><a class="anchor" href="#_io_sg_ready_heat_pump"></a>40. IO SG-Ready Heat Pump</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Controls a heat pump that implements the SG-Ready standard via two Relay contacts, depending on surplus power and battery state-of-charge.</p>
</div>
<div class="sect2">
<h3 id="_states"><a class="anchor" href="#_states"></a>40.1. States</h3>
<div class="paragraph">
<p>The Controller distinguishes the different States, according to the SG-Ready standard.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lock State</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The lock state blocks everything till an internal maximum time of (default) two hours</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Regular State</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The heat pump runs in energy-efficient standard operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recommendation State</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State: The heat pump runs in a more sufficient mode for space heating and hot water production, to use available surplus power</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Force-On State</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The heat pump runs in a definitive start/heat-up mode. Depending on the heat pump, heating is forced and additional heaters may be switched on</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_channels_2"><a class="anchor" href="#_channels_2"></a>40.2. Channels</h3>
<div class="paragraph">
<p>The Controller has an ongoing time counter for every state, that is started and stopped if the corresponding state is active or not.</p>
</div>
<div class="paragraph">
<p>Minimum switching time:
As an additional preventative, the controller has a minimum switching time. If a state changed, it will wait for this time (default 60 seconds) till the next state can be set.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.io.heatpump.sgready">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pv_inverter_fix_power_limit"><a class="anchor" href="#_pv_inverter_fix_power_limit"></a>41. PV-Inverter Fix Power Limit</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sets a fixed power limit for PV-Inverter production.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.pvinverter.fixpowerlimit">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pv_inverter_sell_to_grid_limit"><a class="anchor" href="#_pv_inverter_sell_to_grid_limit"></a>42. PV-Inverter Sell-To-Grid limit</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Dynamically limits the Sell-To-Grid power of a PV-Inverter to a defined maximum power.</p>
</div>
<div class="paragraph">
<p>If the configured mode is asymmetric, the controller evaluates the grid meter phase with the highest Sell-To-Grid power and curbs the PV-power of the configured PV-Inverter.
The main purpose of the asymmetric mode is, to prevent the grid fuse from overcurrent.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.pvinverter.selltogridlimit">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_symmetric_balancing_schedule"><a class="anchor" href="#_symmetric_balancing_schedule"></a>43. Symmetric Balancing Schedule</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Controls a symmetric energy storage system in balancing mode. The control algorithm charges or discharges the battery in order to reach a given power target set-point at the grid connection point. If the target set-point is defined as zero, the behaviour is like with self-consumption optimization.</p>
</div>
<div class="paragraph">
<p>This controller allows two ways of controlling the power target set-point:</p>
</div>
<div class="sect2">
<h3 id="_1_definition_of_a_power_target_set_point_schedule"><a class="anchor" href="#_1_definition_of_a_power_target_set_point_schedule"></a>43.1. 1. Definition of a power target set-point Schedule</h3>
<div class="paragraph">
<p>The static configuration parameter "schedule" takes a Schedule of set-points as a Json-Array. An example schedule looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
	{
		"startTimestamp": 1577836800,
		"duration": 900,
		"activePowerSetPoint": 0
	}, {
		"startTimestamp": 1577837700,
		"duration": 900,
		"activePowerSetPoint": -2000
	}
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This schedule will activate a power target set-point of zero starting at the epoch time 1577836800 (i.e. <strong>seconds</strong> since 1st January 2020 00:00:00 <strong>in timezone UTC</strong>), that lasts for 900 seconds (i.e. 15 minutes).
Afterwards - from 1577837700 - for another 900 seconds a  set-point of -2000 W (i.e. feeding 2000 W to the grid) is targeted.
After the second period passes, no more charging or discharging commands are set on the battery.</p>
</div>
<div class="paragraph">
<p>The schedule configuration parameter may be updated</p>
</div>
<div class="ulist">
<ul>
<li>
<p>via a browser using the OpenEMS user interface</p>
</li>
<li>
<p>using the <a href="https://openems.github.io/openems.io/openems/latest/backend/backend-to-backend.html#_setgridconnschedule"><code>SetGridConnSchedule</code> JSON-RPC Request via OpenEMS Backend</a></p>
</li>
<li>
<p>using a direct <a href="https://github.com/OpenEMS/openems/blob/develop/io.openems.common/src/io/openems/common/jsonrpc/request/SetGridConnScheduleRequest.java">SetGridConnScheduleRequest</a> via <a href="https://openems.github.io/openems.io/openems/latest/component-communication/index.html#_communicate_with_a_specific_edge_component">JsonApi</a></p>
</li>
<li>
<p>or using the <a href="https://github.com/OpenEMS/openems/blob/develop/ui/src/app/shared/jsonrpc/request/updateComponentConfigRequest.ts"><code>UpdateComponentConfigRequest</code> JSON-RPC Request</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Be aware that an <code>UpdateComponentConfigRequest</code> will always result in a actual configuration file being updated by Apache Felix Configuration Admin, so this command should not be used too frequently, e.g. only once per day. The <code>SetGridConnScheduleRequest</code> variant runs only in memory and is not persisted. Downside is, that if OpenEMS Edge gets restarted, the schedule is lost.</p>
</div>
</div>
<div class="sect2">
<h3 id="_2_immediate_control_of_the_power_target_set_point"><a class="anchor" href="#_2_immediate_control_of_the_power_target_set_point"></a>43.2. 2. Immediate control of the power target set-point</h3>
<div class="paragraph">
<p>The power target set-point may also be controlled directly via the <code>GridActivePowerSetPoint</code> channel. E.g. if the controller component has the Id <code>ctrlBalancingSchedule0</code> one can use e.g. the <a href="https://openems.github.io/openems.io/openems/latest/edge/controller.html#_rest_api_controller">REST-Api Controller</a> and write</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
	"value": 5000
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>to the channel <code>ctrlBalancingSchedule0/GridActivePowerSetPoint</code> (e.g. ` <a href="http://x:user@localhost:8084/rest/channel/ctrlBalancingSchedule0/GridActivePowerSetPoint`" class="bare">http://x:user@localhost:8084/rest/channel/ctrlBalancingSchedule0/GridActivePowerSetPoint`</a>), to set a temporary power target set-point of 5000.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.symmetric.balancingschedule">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_symmetric_fix_reactive_power"><a class="anchor" href="#_symmetric_fix_reactive_power"></a>44. Symmetric Fix Reactive Power</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sets a fixed reactive power for a symmetric energy storage system.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.symmetric.fixreactivepower">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_symmetric_limit_active_power"><a class="anchor" href="#_symmetric_limit_active_power"></a>45. Symmetric Limit Active Power</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Limits the allowed active power for charging and discharging of a symmetric energy storage system.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.symmetric.limitactivepower">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_symmetric_peak_shaving"><a class="anchor" href="#_symmetric_peak_shaving"></a>46. Symmetric Peak-Shaving</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Applies peak-shaving at the grid using a symmetric energy storage system.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.symmetric.peakshaving">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_symmetric_random_power"><a class="anchor" href="#_symmetric_random_power"></a>47. Symmetric Random-Power</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Applies random charging/discharging of a symmetric energy storage system for performance tests.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.symmetric.randompower">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_symmetric_timeslot_peak_shaving"><a class="anchor" href="#_symmetric_timeslot_peak_shaving"></a>48. Symmetric Timeslot Peak-Shaving</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Applies peak-shaving within a configured timeslot at the grid using a symmetric energy storage system. Outside of the timeslot the battery recharges.</p>
</div>
<div class="paragraph">
<p>This Controller can be used for "Atypische Netznutzung" applications in Germany, e.g. "Hochlastzeitfenster".</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenEMS/openems/tree/develop/io.openems.edge.controller.symmetric.timeslotpeakshaving">Source Code <span class="icon"><i class="fa fa-github"></i></span></a></p>
</div>
</div>
</div>
</article>
  </main>
</div>
<script src="../../../_/js/site.js"></script>
<script src="../../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
