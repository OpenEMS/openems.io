<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implementing a device :: Open Energy Management System</title>
    <link rel="canonical" href="https://openems.github.io/openems.io/openems/latest/edge/implement.html">
    <meta name="keywords" content="AsciiDoc">
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="icon" href="../../../_/img/feneco.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../_/css/vendor/docsearch.min.css">  </head>
  <body class="article">
<header class="header">
  <nav class="navbar" color="#2d8fab">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://github.com/OpenEMS/openems">OpenEMS // Docs</a>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/OpenEMS/openems">
          <span class="gitlink">
          </span>
        </a>
      </div>
    </div>
  </nav>
</header><div class="main-wrapper">
<div class="navigation-container" data-component="openems" data-version="latest">
  <aside class="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../introduction.html">Open Energy Management System</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../gettingstarted.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../coreconcepts.html">Core concepts &amp; terminology</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">OpenEMS Edge</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuration.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="nature.html">Nature</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="scheduler.html">Scheduler</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="controller.html">Controller</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="bridge.html">Bridge</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="device_service.html">Device &amp; Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="timedata.html">Timedata</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="implement.html">Implementing a Device</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="build.html">Build OpenEMS Edge</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="deploy.html">Deploy OpenEMS Edge</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">OpenEMS UI</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ui/setup-ide.html">Setup IDE</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ui/architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ui/build.html">Build OpenEMS UI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ui/implementing-a-widget.html">Implementing a UI Widget</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">OpenEMS Backend</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../backend/architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../backend/backend-to-backend.html">Backend-to-Backend</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../backend/build.html">Build OpenEMS Backend</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../backend/deploy.html">Deploy OpenEMS Backend</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../component-communication/index.html">Component Communication</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Simulation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../simulation/gitpod.html">Live-Demo on Gitpod</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../simulation/realtime.html">Real-Time Simulation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../simulation/ui-history.html">UI History Simulation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Contribute</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contribute/coding-guidelines.html">Coding Guidelines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contribute/documentation.html">Documentation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://openems.github.io/openems.io/javadoc/">Javadoc</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Open Energy Management System</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Open Energy Management System</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../introduction.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../introduction.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="../introduction.html">Open Energy Management System</a></li>
    <li class="crumb">OpenEMS Edge</li>
    <li class="crumb"><a href="implement.html">Implementing a Device</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/OpenEMS/openems/tree/develop/doc/modules/ROOT/pages/edge/implement.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1>Implementing a device</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_step_by_step_guide">1. Step-by-step guide</a>
<ul class="sectlevel2">
<li><a href="#_create_a_new_osgi_bundle">1.1. Create a new OSGi Bundle</a></li>
<li><a href="#_define_bundle_dependencies">1.2. Define Bundle dependencies</a></li>
<li><a href="#_define_configuration_parameters">1.3. Define configuration parameters</a></li>
<li><a href="#_implement_the_openems_component">1.4. Implement the OpenEMS Component</a></li>
<li><a href="#_junit_tests">1.5. JUnit tests</a></li>
<li><a href="#_start_the_device_simulator">1.6. Start the device simulator</a></li>
<li><a href="#_enable_the_component">1.7. Enable the Component</a></li>
<li><a href="#_run_the_implementation">1.8. Run the implementation</a></li>
<li><a href="#_debug_the_implementation">1.9. Debug the implementation</a></li>
<li><a href="#_alternative_device_development_flow">1.10. Alternative Device Development Flow</a></li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_step_by_step_guide"><a class="anchor" href="#_step_by_step_guide"></a>1. Step-by-step guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter explains the steps required to implement an electric meter in OpenEMS Edge that is connected via Modbus/TCP. The meter itself is simulated using a small Modbus slave application, so no external hardware is required for this guide.</p>
</div>
<div class="paragraph">
<p>The tutorial is based on the <a href="../gettingstarted.html" class="xref page">Getting Started</a> guide.</p>
</div>
<div class="sect2">
<h3 id="_create_a_new_osgi_bundle"><a class="anchor" href="#_create_a_new_osgi_bundle"></a>1.1. Create a new OSGi Bundle</h3>
<div class="paragraph">
<p>For more information see <a href="../coreconcepts.html#_osgi_bundle" class="xref page">OSGi Bundle</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the menu choose <b class="button">File</b> &#8594; <b class="button">New</b> &#8594; <b class="button">Other</b></p>
<div class="imageblock">
<div class="content">
<img src="../_images/eclipse-file-new-other.png" alt="Creating a new project in Eclipse IDE">
</div>
<div class="title">Figure 1. Creating a new project in Eclipse IDE</div>
</div>
</li>
<li>
<p>Select <b class="button">Bndtools</b> &#8594; <b class="button">Bnd OSGi Project</b> and press <b class="button">Next &gt;</b></p>
<div class="imageblock">
<div class="content">
<img src="../_images/eclipse-bndtools-osgi-project.png" alt="Creating a Bnd OSGi Project in Eclipse IDE">
</div>
<div class="title">Figure 2. Creating a Bnd OSGi Project in Eclipse IDE</div>
</div>
</li>
<li>
<p>Select <b class="button">OpenEMS Templates</b> &#8594; <b class="button">OpenEMS Modbus Devices</b> and press <b class="button">Next &gt;</b></p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If the templates are missing, restart the IDE
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/eclipse-new-openems-modbus-device.png" alt="Creating an OpenEMS Modbus Devices Bundle in Eclipse IDE">
</div>
<div class="title">Figure 3. Creating an OpenEMS Modbus Devices Bundle in Eclipse IDE</div>
</div>
</li>
<li>
<p>Choose a project name and press <b class="button">Finish</b></p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The project name is used as the folder name in OpenEMS source directory. The naming is up to you, but it is good practice to keep the name lower case and use something like <strong>io.openems.[edge/backend].[purpose/nature].[implementation]</strong>. For the simulated meter <code>io.openems.edge.meter.simulated</code> is a good choice.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/eclipse-new-osgi-provider-simulatedmeter.png" alt="Naming an OpenEMS Modbus Devices Bundle in Eclipse IDE">
</div>
<div class="title">Figure 4. Naming an OpenEMS Modbus Devices Bundle in Eclipse IDE</div>
</div>
</li>
<li>
<p>Don&#8217;t Create a <code>module-info.java</code> and press <b class="button">Don&#8217;t Create</b></p>
<div class="imageblock">
<div class="content">
<img src="../_images/eclipse-new-osgi-provider-simulatedmeter-final.png" alt="Java settings for an OpenEMS Modbus Devices Bundle in Eclipse IDE">
</div>
<div class="title">Figure 5. Java settings for an OpenEMS Modbus Devices Bundle in Eclipse IDE</div>
</div>
</li>
<li>
<p>The assistant closes and you can see your new bundle.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_define_bundle_dependencies"><a class="anchor" href="#_define_bundle_dependencies"></a>1.2. Define Bundle dependencies</h3>
<div class="paragraph">
<p>OSGi Bundles can be dependent on certain other Bundles. This information needs to be set in a <strong>bnd.bnd</strong> file.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the component directory <b class="button">src</b> &#8594; <b class="button">io.openems.edge.meter.simulated</b></p>
<div class="imageblock">
<div class="content">
<img src="../_images/eclipse-new-simulatedmeter-bundle.png" alt="New simulated meter OpenEMS Modbus Devices Bundle in Eclipse IDE">
</div>
<div class="title">Figure 6. New simulated meter OpenEMS Modbus Devices Bundle in Eclipse IDE</div>
</div>
</li>
<li>
<p>Open the <b class="button">bnd.bnd</b> file by double clicking on it.</p>
</li>
<li>
<p>Open the <b class="button">Build</b> tab</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can see, that the Bundle is by default dependent on some core bundles</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">${buildpath}</dt>
<dd>
<p>applies some defaults defined in <code>/cnf/build.bnd</code></p>
</dd>
<dt class="hdlist1">io.openems.common</dt>
<dd>
<p>OpenEMS commons</p>
</dd>
<dt class="hdlist1">io.openems.edge.bridge.modbus</dt>
<dd>
<p>the Modbus Bridge provides the <a href="bridge.html" class="xref page">Bridge</a> services for Modbus/RTU and Modbus/TCP protocols</p>
</dd>
<dt class="hdlist1">io.openems.edge.common</dt>
<dd>
<p>OpenEMS Edge commons</p>
</dd>
</dl>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/eclipse-bnd-file-build.png" alt="Bndtools Build configuration">
</div>
<div class="title">Figure 7. Bndtools Build configuration</div>
</div>
</li>
<li>
<p>Click the <b class="button">+</b> symbol next to <strong>Build Path</strong>.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/eclipse-osgi-build-path.png" alt="Bndtools Project Build Path configuration">
</div>
<div class="title">Figure 8. Bndtools Project Build Path configuration</div>
</div>
</li>
<li>
<p>Use the <strong>Project Build Path</strong> assistant to add the following Bundle as dependency:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">io.openems.edge.meter.api</dt>
<dd>
<p>The Meter API Bundle provides the interfaces for OpenEMS Edge Meter Nature.</p>
</dd>
</dl>
</div>
</li>
<li>
<p>It is also a good moment to configure the Bundle meta information. Still inside the <b class="button">bnd.bnd</b> file open the <b class="button">Source</b> tab. Adjust the meta information - it will help the users of your component:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Bundle-Name: OpenEMS Edge Meter Simulated
Bundle-Vendor: OpenEMS Association e.V.
Bundle-License: https://opensource.org/licenses/EPL-2.0
Bundle-Version: 1.0.0.${tstamp}

-buildpath: \
	${buildpath},\
	io.openems.common,\
	io.openems.edge.bridge.modbus,\
	io.openems.edge.common,\
	io.openems.edge.meter.api,\

-testpath: \
	${testpath}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>;version=latest</code> declaration is not required and can be removed. Also it is best practice to sort the buildpath bundles alphabetically.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_define_configuration_parameters"><a class="anchor" href="#_define_configuration_parameters"></a>1.3. Define configuration parameters</h3>
<div class="paragraph">
<p>OpenEMS Components can have several configuration parameters. They are defined as Java annotations and specific OSGi annotations are used to generate meta information that is used e.g. by Apache Felix Web Console to generate a user interface form (see <a href="../gettingstarted.html" class="xref page">Getting Started</a>).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the <b class="button">Config.java</b> file inside <code>src/io.openems.edge.meter.simulated</code> by double clicking on it.</p>
</li>
<li>
<p>Adjust the following lines in the template:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <code>@ObjectClassDefinition</code> set the <code>name</code> to <code>"Meter Simulated"</code> and the <code>description</code> to <code>"Implements the simulated meter."</code>.</p>
</li>
<li>
<p>Set the default value of the <code>String id()</code> attribute to <code>"meter0"</code>.</p>
</li>
<li>
<p>After the <code>boolean enabled()</code> attribute add a <code>Meter-Type</code> attribute:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@AttributeDefinition(name = "Meter-Type", description = "Grid, Production (=default), Consumption")
MeterType type() default MeterType.PRODUCTION;</code></pre>
</div>
</div>
</li>
<li>
<p>Set the <code>String webconsole_configurationFactory_nameHint()</code> default value to <code>"Meter Simulated [{id}]"</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>The content should now match the following code:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.openems.edge.meter.simulated;

import org.osgi.service.metatype.annotations.AttributeDefinition;
import org.osgi.service.metatype.annotations.ObjectClassDefinition;

import io.openems.edge.meter.api.MeterType;

@ObjectClassDefinition(<i class="conum" data-value="1"></i><b>(1)</b>
		name = "Meter Simulated", //
		description = "Implements the simulated meter.")
@interface Config {

	@AttributeDefinition(name = "Component-ID", description = "Unique ID of this Component")
	String id() default "meter0"; <i class="conum" data-value="2"></i><b>(2)</b>

	@AttributeDefinition(name = "Alias", description = "Human-readable name of this Component; defaults to Component-ID")
	String alias() default ""; <i class="conum" data-value="3"></i><b>(3)</b>

	@AttributeDefinition(name = "Is enabled?", description = "Is this Component enabled?")
	boolean enabled() default true; <i class="conum" data-value="4"></i><b>(4)</b>

	@AttributeDefinition(name = "Meter-Type", description = "Grid, Production (=default), Consumption") <i class="conum" data-value="5"></i><b>(5)</b>
	MeterType type() default MeterType.PRODUCTION; <i class="conum" data-value="6"></i><b>(6)</b>

	@AttributeDefinition(name = "Modbus-ID", description = "ID of Modbus bridge.")
	String modbus_id() default "modbus0"; <i class="conum" data-value="7"></i><b>(7)</b>

	@AttributeDefinition(name = "Modbus Unit-ID", description = "The Unit-ID of the Modbus device.")
	int modbusUnitId() default 1; <i class="conum" data-value="8"></i><b>(8)</b>

	@AttributeDefinition(name = "Modbus target filter", description = "This is auto-generated by 'Modbus-ID'.")
	String Modbus_target() default "(enabled=true)"; <i class="conum" data-value="9"></i><b>(9)</b>

	String webconsole_configurationFactory_nameHint() default "Meter Simulated [{id}]"; <i class="conum" data-value="10"></i><b>(10)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <strong>@ObjectClassDefinition</strong> annotation defines this file as a Meta Type Resource for OSGi configuration admin. Use it to set a <em>name</em> and <em>description</em> for this OpenEMS Component.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <strong>id</strong> configuration parameter sets the OpenEMS Component-ID (see <a href="../coreconcepts.html" class="xref page">Channel Address</a>). <em>Note</em>: A <strong>default</strong> ID 'meter0' is defined. It is good practice to define such an ID here, as it simplifies configuration in the UI.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <strong>alias</strong> configuration parameter sets the human-readable name of this OpenEMS Component. If no alias is configured, the Component-ID is used instead.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <strong>enabled</strong> parameter provides a <em>soft</em> way of deactivating an OpenEMS Component programmatically.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <strong>@AttributeDefinition</strong> annotation provides meta information about a configuration parameter like <em>name</em> and <em>description</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The 'Meter' nature requires definition of a MeterType that defines the purpose of the Meter. We will let the user define this type by a configuration parameter.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The 'Modbus-ID' parameter creates the link to a Modbus-Service via its OpenEMS Component-ID. At runtime the user will typically set this configuration parameter to something like 'modbus0'.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The Modbus service implementation requires us to provide the Modbus <em>Unit-ID</em> (also commonly called <em>Device-ID</em> or <em>Slave-ID</em>) of the Modbus slave device. This is the ID that is configured at the simulated meter.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>The <strong>Modbus_target</strong> will be automatically set by OpenEMS framework and does usually not need to be configured by the user. <em>Note</em>: Linking other OpenEMS Components is implemented using OSGi References. The OpenEMS Edge framework therefor sets the 'target' property of a reference to filter the matched services.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>The <strong>webconsole_configurationFactory_nameHint</strong> parameter sets a custom name for Apache Felix Web Console, helping the user to find the correct bundle.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_implement_the_openems_component"><a class="anchor" href="#_implement_the_openems_component"></a>1.4. Implement the OpenEMS Component</h3>
<div class="paragraph">
<p>The Bndtools assistant created a <code>MyModbusDevice.java</code> and a <code>MyModbusDeviceImpl.java</code> files. First step is to set proper names for these files. To rename a file, select it by clicking on it and choose <b class="button">Refactor</b> &#8594; <b class="button">Rename&#8230;&#8203;</b> in the menu. Write <code>MeterSimulated</code> and <code>MeterSimulatedImpl</code> respectively as 'New name' and press <b class="button">Finish</b>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/eclipse-rename.png" alt="Renaming a Java class in Eclipse IDE">
</div>
<div class="title">Figure 9. Renaming a Java class in Eclipse IDE</div>
</div>
<div class="paragraph">
<p>Afterwards adjust the following content in the template <code>MeterSimulatedImpl.Java</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <code>@Component</code> annotation set the <code>name</code> to <code>"Meter.Simulated"</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Component(//
		name = "Meter.Simulated", //
		immediate = true, //
		configurationPolicy = ConfigurationPolicy.REQUIRE //
)</code></pre>
</div>
</div>
</li>
<li>
<p>Make the class implement the <code>SymmetricMeter</code> nature:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MeterSimulatedImpl extends AbstractOpenemsModbusComponent implements MeterSimulated, SymmetricMeter, OpenemsComponent, ModbusComponent {</code></pre>
</div>
</div>
</li>
<li>
<p>Eclipse will underline <code>SymmetricMeter</code> and show you the error <strong>SymmetricMeter cannot be resolved to a type</strong>. Resolve it by importing adding an <code>import io.openems.edge.meter.api.SymmetricMeter;</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The easiest way to fix these kind of import errors is to to selecto <b class="button">Source</b> → <b class="button">Organize Imports</b> in the menu or simply press <b class="button">Ctrl</b> + <b class="button">Shift</b> + <b class="button">o</b>. Alternatively click the 'error light bulb' next to the line with the error and select <b class="button">Import 'SymmetricMeter' (io.openems.edge.meter.api)</b>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Eclipse still complains and now underlines the class name <code>MeterSimulated</code> with the error <strong>The type MeterSimulated must implement the inherited abstract method SymmetricMeter.getMeterType()</strong>. Resolve it by adding an implementation of the <code>getMeterType()</code> method:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
public MeterType getMeterType() {
	return this.config.type();
}</code></pre>
</div>
</div>
</li>
<li>
<p>Tell the OpenEMS framework that <code>MeterSimulated</code> provides the SymmetricMeter <strong>Channels</strong>, by adjusting the constructor:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public MeterSimulatedImpl() {
	super(//
			OpenemsComponent.ChannelId.values(), //
			SymmetricMeter.ChannelId.values(), //
			ModbusComponent.ChannelId.values(), //
			MeterSimulated.ChannelId.values() //
	);
}</code></pre>
</div>
</div>
</li>
<li>
<p>Finally we need to declare the modbus protocol of the simulated meter inside the <code>defineModbusProtocol</code> method. Replace the existing method</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
protected ModbusProtocol defineModbusProtocol() throws OpenemsException {
	// TODO implement ModbusProtocol
	return new ModbusProtocol(this);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
protected ModbusProtocol defineModbusProtocol() throws OpenemsException {
	return new ModbusProtocol(this, //
			new FC3ReadRegistersTask(1000, Priority.HIGH,
					m(SymmetricMeter.ChannelId.ACTIVE_POWER, new SignedWordElement(1000))));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and solve the import errors again as described above.</p>
</div>
</li>
<li>
<p>Additionally it is advisable to implement a <code>debugLog()</code> method. This method provides information for the continuous log output of OpenEMS, provided by the <strong>DebugLogController</strong>. Adjust the method to return the ActivePower value of the meter:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
public String debugLog() {
	return "L:" + this.getActivePower().asString();
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The content of <code>MeterSimulatedImpl.java</code> should now match the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.openems.edge.meter.simulated;

import org.osgi.service.cm.ConfigurationAdmin;
import org.osgi.service.component.ComponentContext;
import org.osgi.service.component.annotations.Activate;
import org.osgi.service.component.annotations.Component;
import org.osgi.service.component.annotations.ConfigurationPolicy;
import org.osgi.service.component.annotations.Deactivate;
import org.osgi.service.component.annotations.Reference;
import org.osgi.service.component.annotations.ReferenceCardinality;
import org.osgi.service.component.annotations.ReferencePolicy;
import org.osgi.service.component.annotations.ReferencePolicyOption;
import org.osgi.service.metatype.annotations.Designate;

import io.openems.edge.bridge.modbus.api.AbstractOpenemsModbusComponent;
import io.openems.edge.bridge.modbus.api.BridgeModbus;
import io.openems.edge.bridge.modbus.api.ModbusProtocol;
import io.openems.edge.bridge.modbus.api.element.SignedWordElement;
import io.openems.edge.bridge.modbus.api.task.FC3ReadRegistersTask;
import io.openems.edge.common.channel.Doc;
import io.openems.edge.common.component.OpenemsComponent;
import io.openems.edge.common.taskmanager.Priority;
import io.openems.edge.meter.api.MeterType;
import io.openems.edge.meter.api.SymmetricMeter;

@Designate(ocd = Config.class, factory = true) <i class="conum" data-value="1"></i><b>(1)</b>
@Component(<i class="conum" data-value="2"></i><b>(2)</b>
		name = "Meter.Simulated", <i class="conum" data-value="3"></i><b>(3)</b>
		immediate = true, <i class="conum" data-value="4"></i><b>(4)</b>
		configurationPolicy = ConfigurationPolicy.REQUIRE <i class="conum" data-value="5"></i><b>(5)</b>
)
public class MeterSimulatedImpl extends AbstractOpenemsModbusComponent <i class="conum" data-value="6"></i><b>(6)</b>
	implements MeterSimulated, SymmetricMeter, OpenemsComponent, ModbusComponent { <i class="conum" data-value="7"></i><b>(7)</b>

	private Config config = null;

	public MeterSimulatedImpl() {
		super(<i class="conum" data-value="8"></i><b>(8)</b>
				OpenemsComponent.ChannelId.values(), //
				SymmetricMeter.ChannelId.values(), //
				ModbusComponent.ChannelId.values(), //
				MeterSimulated.ChannelId.values() //
		);
	}

	@Reference
	protected ConfigurationAdmin cm; <i class="conum" data-value="9"></i><b>(9)</b>

	@Reference(policy = ReferencePolicy.STATIC, policyOption = ReferencePolicyOption.GREEDY, cardinality = ReferenceCardinality.MANDATORY)
	protected void setModbus(BridgeModbus modbus) {
		super.setModbus(modbus); <i class="conum" data-value="10"></i><b>(10)</b>
	}

	@Activate
	void activate(ComponentContext context, Config config) throws OpenemsException { <i class="conum" data-value="11"></i><b>(11)</b>
		if(super.activate(context, config.id(), config.alias(), config.enabled(), config.modbusUnitId(), this.cm, "Modbus", config.modbus_id())) {
			return;
		}
		this.config = config;
	}

	@Deactivate
	protected void deactivate() { <i class="conum" data-value="12"></i><b>(12)</b>
		super.deactivate();
	}

	@Override
	protected ModbusProtocol defineModbusProtocol() throws OpenemsException { <i class="conum" data-value="13"></i><b>(13)</b>
		return new ModbusProtocol(this, <i class="conum" data-value="14"></i><b>(14)</b>
				new FC3ReadRegistersTask(1000, Priority.HIGH, <i class="conum" data-value="15"></i><b>(15)</b>
						m(SymmetricMeter.ChannelId.ACTIVE_POWER, new SignedWordElement(1000)))); <i class="conum" data-value="16"></i><b>(16)</b>
	}

	@Override
	public MeterType getMeterType() { <i class="conum" data-value="17"></i><b>(17)</b>
		return this.config.type();
	}

	@Override
	public String debugLog() { <i class="conum" data-value="18"></i><b>(18)</b>
		return "L:" + this.getActivePower().asString();
	}
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <strong>@Designate</strong> annotation is used for OSGi to create a connection to the <em>Config</em> annotation class. It also defines this Component as a <em>factory</em>, i.e. it can produce multiple instances with different configurations.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <strong>@Component</strong> annotation marks this class as an OSGi component.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <strong>name</strong> property sets the unique name of this component. It is used to store configuration in the filesystem, to identify the component inside Apache Felix Web Console, and so on. Configure a human-readable name in the form <strong>[nature].[vendor].[product]</strong>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <strong>immediate</strong> property defines whether the component should be started immediately. Configure the Component to be started immediately after configuration, i.e. it is not waiting till its service is required by another Component.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <strong>configurationPolicy</strong> define that the configuration of the Component is required before it gets activated.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>To ease the implementation of a Modbus device we can extend the <strong>AbstractOpenemsModbusComponent</strong> class.
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the device was using another protocol, it is advisable to use the <strong>AbstractOpenemsComponent</strong> class as a convenience layer instead of implementing everything required by the <strong>OpenemsComponent</strong> interface manually.
</td>
</tr>
</table>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The class implements <strong>OpenemsComponent</strong>. This makes it an <a href="../coreconcepts.html#<em>openems_component" class="xref page">OpenEMS Component</a>.
The Device that we are is a <strong>SymmetricMeter</strong>. We already defined the required Channels in the _initializeChannels()</em> method. Additionally the Component also needs to implement the Nature interface.
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In plain Java it is not required to add <code>implements OpenemsComponent</code> if we inherit from 'AbstractOpenemsComponent' or 'AbstractOpenemsModbusComponent'. Be aware that for OSGi dependency injection to function properly, it is still required to mention all implemented interfaces again, as it is not considering the complete inheritance tree.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Channel declarations are <strong>enum</strong> types implementing the ChannelId interface.</p>
</li>
<li>
<p>This enum is empty, as we do not have custom Channels here.</p>
</li>
<li>
<p>ChannelId enums require a Doc object that provides meta information about the Channel - e.g. the above ACTIVE_POWER Channel is defined as <code>ACTIVE_POWER(new Doc().type(OpenemsType.INTEGER).unit(Unit.WATT)</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>We call the constructor of the super class (<code>AbstractOpenemsModbusComponent</code>/<code>AbstractOpenemsComponent</code>) to initialize the Channels of the Component. It is important to list all ChannelId-Enums of all implemented Natures. The call takes the <strong>ChannelId</strong> declarations and creates a Channel instance for each of them; e.g. for the <code>SymmetricMeter.ACTIVE_POWER</code> ChannelId, an object instance of <code>IntegerReadChannel</code> is created that represents the Channel.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>The <code>super.activate()</code> method requires an instance of <strong>ConfigurationAdmin</strong> as a parameter. Using the <strong>@Reference</strong> annotation the OSGi framework is going to provide the ConfigurationAdmin service via dependency injection.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>The Component utilizes an external Modbus Component (the <em>Modbus Bridge</em>) for the actual Modbus communication. We receive an instance of this service via dependency injection (like we did already for the <em>ConfigurationAdmin</em> service). Most of the magic is handled by the <em>AbstractOpenemsModbusComponent</em> implementation, but the way the OSGi framework works, we need to define the <em>@Reference</em> explicitly here in the actual implementation of the component and call the parent <code>setModbus()</code> method.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>The <strong>activate()</strong> method (marked by the <strong>@Activate</strong> annotation) is called on activation of an object instance of this Component. It comes with a ComponentContext and an instance of a configuration in the form of a Config object. All logic for activating and deactivating the OpenEMS Component is hidden in the super classes and just needs to be called from here.</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>The <strong>deactivate()</strong> method (marked by the <strong>@Deactivate</strong> annotation) is called on deactivation of the Component instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="13"></i><b>13</b></td>
<td><em>AbstractOpenemsModbusComponent</em> requires to implement a <strong>defineModbusProtocol()</strong> method that returns an instance of <strong>ModbusProtocol</strong>. The <em>ModbusProtocol</em> class maps Modbus addresses to OpenEMS Channels and provides some conversion utilities. Instantiation of a <em>ModbusProtocol</em> object uses the <a href="https://en.wikipedia.org/wiki/Builder_pattern#Java">Builder pattern <span class="icon"><i class="fa fa-external-link"></i></span></a></td>
</tr>
<tr>
<td><i class="conum" data-value="14"></i><b>14</b></td>
<td>Creates a <strong>new ModbusProtocol</strong> instance. A reference to the component itself is the first parameter, followed by an arbitrary number of 'Tasks' (implemented as a Java varags array).</td>
</tr>
<tr>
<td><i class="conum" data-value="15"></i><b>15</b></td>
<td><strong>FC3ReadRegistersTask</strong> is an implementation of Modbus <a href="http://www.simplymodbus.ca/FC03.htm">function code 3 "Read Holding Registers" <span class="icon"><i class="fa fa-external-link"></i></span></a>. Its first parameter is the start address of the register block. The second parameter is a priority information that defines how often this register block needs to be queried. Following parameters are an arbitrary number of <strong>ModbusElements</strong>.
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Most Modbus function codes are available by their respective <em>FC*</em> implementation classes.
</td>
</tr>
</table>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="16"></i><b>16</b></td>
<td>Here the internal <strong>m()</strong> method is used to make a simple 1-to-1 mapping between the Modbus element at address <code>1000</code> and the Channel <em>SymmetricMeter.ChannelId.ACTIVE_POWER</em>. The Modbus element is defined as a 16 bit word element with an signed integer value.
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The <em>m()</em> method also takes an instance of <strong>ElementToChannelConverter</strong> as an additional parameter. It can be used to add implicit unit conversions between Modbus element and OpenEMS Channel - like adding a scale factor that converts a read value of '95' to a channel value of '950'.</p>
</li>
<li>
<p>For Modbus registers that are empty or should be ignored, the <strong>DummyRegisterElement</strong> can be used.</p>
</li>
<li>
<p>For more advanced channel-to-element mapping functionalities the internal <strong>cm()</strong> method can be used - e.g. to map one Modbus element to multiple Channels.</p>
<div class="paragraph">
<p>Using this principle a complete Modbus table consisting of multiple register blocks that need to be read or written with different Modbus function codes can be defined. For details have a look at the existing implementation classes inside the Modbus Bridge source code.
&lt;17&gt; The SymmetricMeter Nature requires us to provide a <strong>MeterType</strong> via a <code>MeterType getMeterType()</code> method. The MeterType is provided by the Config.
&lt;18&gt; Finally it is always a good idea to define a <strong>debugLog()</strong> method. This method is called in each cycle by the <strong>Controller.Debug.Log</strong> and very helpful for continuous debugging.</p>
</div>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div></td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_junit_tests"><a class="anchor" href="#_junit_tests"></a>1.5. JUnit tests</h3>
<div class="paragraph">
<p>OpenEMS comes with an advanced test framework based on JUnit. The test scenarios are defined inside the <code>test</code> folder. The template we used before provides example implementations for <code>MyConfig.java</code> and <code>MyModbusDeviceTest.java</code>. We highly recommend implementing JUnit tests, because down the line it simplifies 'dry' coding (i.e. without using physical hardware) and assures high quality of the code you write. There are plenty of simple and advanced examples for JUnit tests throughout the OpenEMS project.</p>
</div>
<div class="paragraph">
<p>For now, to keep this tutorial simple, you can just delete the <code>io.openems.edge.meter.simulated</code> folder inside the <code>test</code> folder, to get rid of the compile errors in Eclipse IDE and be able to continue.</p>
</div>
</div>
<div class="sect2">
<h3 id="_start_the_device_simulator"><a class="anchor" href="#_start_the_device_simulator"></a>1.6. Start the device simulator</h3>
<div class="paragraph">
<p>To start the device simulator, open the <b class="button">io.openems.edge.bridge.modbus</b> project and navigate to the <b class="button">test</b> &#8594; <b class="button">io.openems.edge.bridge.modbus</b> folder. There you find the <b class="button">ModbusSlaveSimulator.java</b> file. Right-click that file and select <b class="button">Run As</b> &#8594; <b class="button">Java Application</b>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This <em>ModbusSlaveSimulator</em> runs a small Modbus-TCP <em>Slave</em>-Server, that provides some constant values:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constant value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">123</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the end of this guide, you will see a production of '500 W' - where '500' comes from register address 1000.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Modbus-TCP <em>Slave</em>-Server opens on the non-standard port <code>8502</code>. The default standardized port for Modbus-TCP is <code>502</code>, but we chose <code>8502</code> here, because if you run this example on a Linux system it will not allow you to occupy ports below <code>1024</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_enable_the_component"><a class="anchor" href="#_enable_the_component"></a>1.7. Enable the Component</h3>
<div class="paragraph">
<p>To enable the Component for running, open the <b class="button">io.openems.edge.application</b> project and open the <b class="button">EdgeApp.bndrun</b> file.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/eclipse-edgeapp-bndrun.png" alt="Eclipse IDE EdgeApp.bndrun">
</div>
<div class="title">Figure 10. Eclipse IDE EdgeApp.bndrun</div>
</div>
<div class="paragraph">
<p>Select the <code>io.openems.edge.meter.simulated</code> bundle in the left <strong>Repositories</strong> list and drag &amp; drop it to the <strong>Run Requirements</strong> list.</p>
</div>
<div class="paragraph">
<p>Press <b class="button">Ctrl</b> + <b class="button">s</b> to save the <code>EdgeApp.bndrun</code> file.</p>
</div>
<div class="paragraph">
<p>Click on <b class="button">Resolve</b> to update the list of bundles that are required to run OpenEMS Edge. After a few seconds the <strong>Resolution Results</strong> window should appear; acknowledge by pressing <b class="button">Finish</b>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/eclipse-edgeapp-resolve.png" alt="Eclipse IDE Resolve EdgeApp.bndrun">
</div>
<div class="title">Figure 11. Eclipse IDE Resolve EdgeApp.bndrun</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>These steps changed the content of the 'EdgeApp.bndrun' file. You can observe the changes inside the <strong>Source</strong> tab:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The drag &amp; drop caused a new line to be added under <code>-runrequires: \</code>:</p>
<div class="paragraph">
<p><code>bnd.identity;id='io.openems.edge.meter.simulated'</code></p>
</div>
</li>
<li>
<p>Resolving updated the <code>-runbundles: \</code> list by adding the line:</p>
<div class="paragraph">
<p><code>io.openems.edge.meter.simulated;version='[1.0.0,1.0.1)'</code></p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>\</code> at the end of each line is required to announce bndtools that the definition still continues on the next line.</p>
</div>
<div class="paragraph">
<p>Also you may have found, that the existing entries are sorted alphabetically.</p>
</div>
<div class="paragraph">
<p>Now switch back to <b class="button">Run</b> view.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_run_the_implementation"><a class="anchor" href="#_run_the_implementation"></a>1.8. Run the implementation</h3>
<div class="paragraph">
<p>Press <b class="button">Run OSGi</b> to run OpenEMS Edge.</p>
</div>
<div class="paragraph">
<p>From then you can configure your component as shown in <a href="../gettingstarted.html" class="xref page">Getting Started</a> guide. Add the following configurations inside Apache Felix Web Console:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Controller Debug Log</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Component-ID: <code>ctrlDebugLog0</code></p>
</li>
<li>
<p>Is enabled: <code>checked</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Scheduler All Alphabetically</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Component-ID: <code>scheduler0</code></p>
</li>
<li>
<p>Is enabled: <code>checked</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Bridge Modbus/TCP</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Component-ID: <code>modbus0</code></p>
</li>
<li>
<p>Is enabled: <code>checked</code></p>
</li>
<li>
<p>IP-Address: <code>localhost</code></p>
</li>
<li>
<p>Port: <code>8502</code> (non-standard, as explained above)</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Meter Simulated</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Component-ID: <code>meter0</code></p>
</li>
<li>
<p>Is enabled: <code>checked</code></p>
</li>
<li>
<p>Meter-Type: <code>PRODUCTION</code></p>
</li>
<li>
<p>Modbus-ID: <code>modbus0</code></p>
</li>
<li>
<p>Modbus Unit-ID: <code>1</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In the Eclipse IDE console log you should see an output like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[re.Cycle] INFO  [ntroller.debuglog.DebugLogImpl] [ctrlDebugLog0] _sum[State:Ok Production:500 W Consumption:500 W] meter0[L:500 W]</pre>
</div>
</div>
<div class="paragraph">
<p>It shows a Production of <code>500 W</code> which is what is provided by the simulated meter device. Congrats!</p>
</div>
</div>
<div class="sect2">
<h3 id="_debug_the_implementation"><a class="anchor" href="#_debug_the_implementation"></a>1.9. Debug the implementation</h3>
<div class="paragraph">
<p>If you experience any errors you can always run OpenEMS Edge using the <b class="button">Debug OSGi</b> button in EdgeApp.bndrun. This allows you to stop code execution at any time using <a href="https://help.eclipse.org/2019-12/index.jsp?topic=%2Forg.eclipse.jdt.doc.user%2Ftasks%2Ftask-add_line_breakpoints.htm">Breakpoints</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_alternative_device_development_flow"><a class="anchor" href="#_alternative_device_development_flow"></a>1.10. Alternative Device Development Flow</h3>
<div class="paragraph">
<p>Instead of adding the device to the <b class="button">EdgeApp.bndrun</b> file (as described in <a href="#implement.adoc#_enable_the_component" class="xref unresolved">Enable the Component</a>), the device can be loaded dynamically by using [Apache Felix File Install]. Copying the device&#8217;s built jar file into a <code>load</code> folder, relative to the project&#8217;s root directory. Apache Felix File Install watches this folder and handles the device automatically.</p>
</div>
<div class="paragraph">
<p>The folder is configurable by supplying the <code>felix.fileinstall.dir</code> option when starting the edge app. More configuration options can be found in the <a href="https://felix.apache.org/documentation/subprojects/apache-felix-file-install.html">Apache Felix File Install documentation</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This functionality can also be used in production environments albeit dynamic code loading without additional safety measures is not recommended.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Same applies to the OpenEMS Backend for dynamically loading devices.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</article>
  </main>
</div>
<script src="../../../_/js/site.js"></script>
<script src="../../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
